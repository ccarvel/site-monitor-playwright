<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Web Sentinel Pro</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .dot { height: 12px; width: 12px; border-radius: 50%; display: inline-block; margin-right: 2px; border: 1px solid #0002; }
        .bg-healthy { background-color: #28a745; }
        .bg-issue { background-color: #dc3545; }
        .bg-warning { background-color: #ffc107; }
        .screenshot-thumb { max-height: 60px; border-radius: 4px; border: 1px solid #ddd; cursor: zoom-in; }
    </style>
</head>
<body class="bg-light">
    <div class="container py-5">
        <h1 class="mb-4">Web Sentinel</h1>
        
        <div class="card shadow-sm mb-5">
            <div class="card-header bg-dark text-white">Add New Monitoring Target</div>
            <div class="card-body">
                <form action="/add" method="post" class="row g-3">
                    <div class="col-md-3">
                        <label class="form-label small">URL</label>
                        <input type="url" name="url" class="form-control" placeholder="https://google.com" required>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label small">Keyword to Verify</label>
                        <input type="text" name="search_string" class="form-control" placeholder="Login" required>
                    </div>
                    <div class="col-md-2">
                        <label class="form-label small">Freq (Mins)</label>
                        <input type="number" name="frequency" class="form-control" value="5" min="1">
                    </div>
                    <div class="col-md-2">
                        <label class="form-label small">Device Viewport</label>
                        <select name="device_type" class="form-select">
                            <option value="desktop">Desktop (1920px)</option>
                            <option value="mobile">Mobile (iPhone)</option>
                        </select>
                    </div>
                    <div class="col-md-2 d-flex align-items-end">
                        <button type="submit" class="btn btn-success w-100">Add Site</button>
                    </div>
                </form>
            </div>
        </div>

        <h3>Active Monitors</h3>
        <table class="table table-hover bg-white border mb-5 shadow-sm">
            <thead class="table-light">
                <tr><th>Target URL</th><th>History (Last 5)</th><th>Current Status</th><th>Actions</th></tr>
            </thead>
            <tbody>
                {% for site in sites %}
                <tr>
                    <td>
                        <strong>{{ site.url }}</strong><br>
                        <span class="badge bg-info text-dark" style="font-size: 0.7rem;">{{ site.device_type|upper }}</span>
                        <small class="text-muted ms-2">Keyword: "{{ site.search_string }}"</small>
                    </td>
                    <td>
                        {% for status in site_history[site.id] %}
                            <span class="dot {% if 'Healthy' in status %}bg-healthy{% elif 'Down' in status %}bg-issue{% else %}bg-warning{% endif %}" title="{{ status }}"></span>
                        {% endfor %}
                    </td>
                    <td>
                        <span class="badge bg-secondary">{{ site.last_status }}</span><br>
                        <small class="text-muted" style="font-size: 0.7rem;">Last: {{ site.last_check.strftime('%H:%M:%S') if site.last_check else 'Never' }}</small>
                    </td>
                    <td>
                        <div class="d-flex gap-1">
                            <form action="/check/{{ site.id }}" method="post"><button class="btn btn-primary btn-sm">Check Now</button></form>
                            <form action="/delete/{{ site.id }}" method="post" onsubmit="return confirm('Delete?');"><button class="btn btn-outline-danger btn-sm">Delete</button></form>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <h3>Recent Activity Logs</h3>
        <table class="table table-sm bg-white border shadow-sm">
            <thead class="table-dark"><tr><th>Time</th><th>Site</th><th>Result</th><th>Screenshot</th></tr></thead>
            <tbody>
                {% for log in logs %}
                <tr>
                    <td class="small">{{ log.timestamp.strftime('%H:%M:%S') }}</td>
                    <td class="small">{{ site_map[log.site_id] }}</td>
                    <td><small>{{ log.status }}</small></td>
                    <td>{% if log.screenshot_path %}<a href="/screenshots/{{ log.screenshot_path }}" target="_blank"><img src="/screenshots/{{ log.screenshot_path }}" class="screenshot-thumb"></a>{% endif %}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</body>
</html>